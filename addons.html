<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Owen Lab ‚Ä¢ Addons</title>

    <link rel="icon" type="image/png" href="assets/icons/favicon.png">
    <link rel="stylesheet" href="style.css" />
</head>

<body class="addons-page">
<header class="top-nav">
    <div class="nav-left">
        <a href="index.html" class="brand">OWEN LAB</a>
    </div>

    <nav class="nav-links">
        <a href="index.html" class="nav-btn">Overview</a>
        <a href="projects.html" class="nav-btn">Projects</a>
        <a href="mods.html" class="nav-btn">Mods</a>
        <a href="addons.html" class="nav-btn active">Addons</a>
    </nav>
</header>

<main class="page">
    <section class="hero">
        <div>
            <h1 class="title">Minecraft Addons</h1>
            <p class="subtitle">
                This page is for my <strong>Minecraft: Bedrock Edition</strong> utility addons, built as lightweight
                behavior packs focused on survival-friendly quality-of-life improvements.
            </p>
        </div>
    </section>

    <section class="grid">
        <!-- OreFeller -->
        <article class="card">
            <div class="card-top">
                <img class="icon" src="assets/addons/orefeller.png" alt="OreFeller icon">
                <div class="titleblock">
                    <h2>‚õèÔ∏è OreFeller</h2>
                    <p class="meta">Minecraft Bedrock ‚Ä¢ Behavior Pack</p>
                </div>
            </div>

            <p class="desc">
                Automatically mines all connected ore blocks when you break one.
            </p>

            <!-- OreFeller demo GIF -->
            <img
                    class="demo"
                    src="assets/addons/OreFeller.gif"
                    alt="OreFeller mining connected ore veins demo"
                    loading="lazy"
            />

            <div class="chips">
                <span class="chip">Survival-Friendly</span>
                <span class="chip">Multiplayer-Safe</span>
                <span class="chip">No Commands</span>
                <span class="pill" id="of-total-downloads">Downloads: ‚Ä¶</span>
            </div>

            <div class="links">
                <a class="btn" href="https://legacy.curseforge.com/minecraft-bedrock/addons/orefeller" target="_blank" rel="noreferrer">CurseForge</a>
                <a class="btn ghost" href="https://github.com/omueller5/OreFeller" target="_blank" rel="noreferrer">GitHub</a>
            </div>
        </article>

        <!-- TreeFeller -->
        <article class="card">
            <div class="card-top">
                <img class="icon" src="assets/addons/treefeller.png" alt="TreeFeller icon">
                <div class="titleblock">
                    <h2>üå≤ TreeFeller</h2>
                    <p class="meta">Minecraft Bedrock ‚Ä¢ Behavior Pack</p>
                </div>
            </div>

            <p class="desc">
                Break a tree normally and the full tree is felled automatically.
            </p>

            <!-- TreeFeller demo GIF -->
            <img
                    class="demo"
                    src="assets/addons/TreeFeller.gif"
                    alt="TreeFeller felling a full tree demo"
                    loading="lazy"
            />

            <div class="chips">
                <span class="chip">Survival-Friendly</span>
                <span class="chip">Multiplayer-Safe</span>
                <span class="chip">No Commands</span>
                <span class="pill" id="tf-total-downloads">Downloads: ‚Ä¶</span>
            </div>

            <div class="links">
                <a class="btn" href="https://legacy.curseforge.com/minecraft-bedrock/addons/treefeller" target="_blank" rel="noreferrer">CurseForge</a>
                <a class="btn ghost" href="https://github.com/omueller5/TreeFeller" target="_blank" rel="noreferrer">GitHub</a>
            </div>
        </article>

        <!-- Fast Leaf Decay (no GIF) -->
        <article class="card">
            <div class="card-top">
                <img class="icon" src="assets/addons/fastleafdecay.png" alt="FastLeafDecay icon">
                <div class="titleblock">
                    <h2>üåø Fast Leaf Decay</h2>
                    <p class="meta">Minecraft Bedrock ‚Ä¢ Behavior Pack</p>
                </div>
            </div>

            <p class="desc">
                Leaves decay almost instantly after logs are removed, keeping your world clean while preserving vanilla drops.
            </p>

            <div class="chips">
                <span class="chip">Survival-Friendly</span>
                <span class="chip">Multiplayer-Safe</span>
                <span class="chip">No Commands</span>
                <span class="pill" id="fld-total-downloads">Downloads: ‚Ä¶</span>
            </div>

            <div class="links">
                <a class="btn" href="https://legacy.curseforge.com/minecraft-bedrock/addons/fastleafdecay" target="_blank" rel="noreferrer">CurseForge</a>
                <a class="btn ghost" href="https://github.com/omueller5/FastLeafDecay" target="_blank" rel="noreferrer">GitHub</a>
            </div>
        </article>
    </section>
</main>

<footer class="footer">
    <p>¬© <span id="year"></span> Owen Lab. All rights reserved.</p>
</footer>

<script src="script.js"></script>

<script>
    // =========================================================
    // CurseForge download pills (CFWidget JSON API)
    // =========================================================
    // Uses your CurseForge "path" (minecraft-bedrock/addons/<slug>).
    // CFWidget can respond 202 while it queues the project; we retry a few times.
    // =========================================================

    function formatDownloads(n) {
        if (!Number.isFinite(n)) return "‚Ä¶";
        return Intl.NumberFormat("en-US", { notation: "compact", maximumFractionDigits: 1 }).format(n);
    }

    async function fetchCFWidget(path, retries = 7, delayMs = 650) {
        const url = `https://api.cfwidget.com/${path}`;

        for (let i = 0; i <= retries; i++) {
            const res = await fetch(url, { headers: { "Accept": "application/json" } });

            // 202 = queued/not ready yet (retry)
            if (res.status === 202) {
                if (i === retries) throw new Error("CFWidget queued too long");
                await new Promise(r => setTimeout(r, delayMs));
                continue;
            }

            if (!res.ok) throw new Error(`CFWidget error ${res.status}`);

            return await res.json();
        }

        throw new Error("CFWidget fetch failed");
    }

    function extractTotalDownloads(data) {
        // Be defensive: different payloads may vary.
        // Prefer a "total" if present; otherwise try common keys.
        const d = data && data.downloads ? data.downloads : null;
        if (!d) return NaN;

        const candidates = [
            d.total,
            d.totalDownloads,
            d.downloads,
            d.all_time,
            d.allTime
        ];

        for (const v of candidates) {
            const num = Number(v);
            if (Number.isFinite(num)) return num;
        }

        return NaN;
    }

    async function setDownloads(pillId, cfPath) {
        const pill = document.getElementById(pillId);
        if (!pill) return;

        try {
            const data = await fetchCFWidget(cfPath);
            const total = extractTotalDownloads(data);

            if (Number.isFinite(total)) {
                pill.textContent = `Downloads: ${formatDownloads(total)}`;
            }
        } catch (e) {
            // Leave fallback "Downloads: ‚Ä¶" if anything fails.
        }
    }

    // Your CurseForge links (non-legacy) map perfectly to these paths:
    // https://www.curseforge.com/minecraft-bedrock/addons/<slug>
    setDownloads("of-total-downloads", "minecraft-bedrock/addons/orefeller");
    setDownloads("tf-total-downloads", "minecraft-bedrock/addons/treefeller");
    setDownloads("fld-total-downloads", "minecraft-bedrock/addons/fastleafdecay");
</script>
</body>
</html>
